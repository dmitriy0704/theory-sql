# СТРУКТУРА ОПЕРАТОРА SELECT И ФОРМИРОВАНИЕ УСЛОВИЙ ВЫБОРА

Операторы SQL разделены на три группы:

1. Операторы манипулирования данными (Data Manipulation Language,
   DML) — предназначены для выборки и изменения данных: SELECT,
   INSERT, UPDATE, MERGE, DELETE.
2. Операторы определения данных (Data Definition Language, DDL) —
   предназначены для создания и модификации объектов базы данных. Основными
   операторами этой группы являются: CREATE, ALTER, DROP.
3. Операторы управления данными (Data Control Language, DCL) —
   предназначены для предоставления пользователям прав на выполнение
   определенных действий с базой данных: GRANT, REVOKE.

## СТРУКТУРА ОПЕРАТОРА SELECT

    SELECT [ALL(DISTINCT] {список столбцов или выражений}
    [FROM {список таблиц}]
    [WHERE {условия выбора}]
    [GROUP BY {столбцы группировки}]
    [HAVING {условия на группу}];
    [ORDER BY {столбцы сортировки [ASC|DESC]]}
    [LIMIT {N} ] [OFFSET{М}];

(Квадратными скобками отмечены необязательные элементы).

Описание элементов:

- Оператор SELECT начинается со списка столбцов или выражений, значения
  которых будет отображаться в результате выполнения запроса. По умолчанию
  SELECT не исключает дублирование строк. Для исключения дублирования следует
  использовать ключевое слово DISTINCT.
- В предложении FROM указываются источники данных. В качестве таких
  источников можно использовать таблицы базы данных, которые возвращают
  подзапросы или представления. В тех запросах, где используется несколько
  таблиц, необходимо указывать условия соединения. Если этого не сделать, то
  будет осуществляться декартово произведение таблиц.
- Предложение WHERE содержит условия выбора строк, а также может содержать
  условия соединения таблиц в многотабличных запросах.
- В предложении GROUP BY можно указать столбцы, по которым следует осуществить
  группировку. Группировка состоит в том, что несколько строк, имеющих
  совпадающие значения столбцов, по которым осуществляется группировка,
  объединяются в одну строку. Обычно группировка используется в запросах,
  использующих агрегатные функции, например:Sum(), Мах().

## Условия выбора (WHERE)

Для того чтобы выводить только те данные, которые
удовлетворяют определенным условиям, оператор SELECT
должен содержать предложение WHERE, которое содержит
условное выражение:

```
SELECT {список столбцов}
FROM {таблица}
WHERE {условное выражение};
```

Условное выражение для каждой строки таблицы может принимать значения:
ИСТИНА (TRUE), ЛОЖЬ (FALSE), НЕ ОПРЕДЕЛЕНО (UNKNOWN).
Результат выполнения запроса будет содержать только те
строки, для которых условное выражение будет иметь значение ИСТИНА (TRUE).

В условных выражениях предложения WHERE могут быть использованы
операторы сравнения =, >, < и логические операторы NOT, AND, OR. Логические
операторы используются для формирования сложных условий выбора
и имеют разный приоритет. Сначала выполняются все операторы NOT,
потом операторы AND; операторы OR выполняются в последнюю очередь.
Для исключения возможных ошибок при формировании сложных запросов
следует использовать скобки. Выражения внутри скобок выполняются первыми,
слева направо.

```
SELECT employee_id, first_name, last_name, department_id, job_id
FROM Employees
WHERE (department_id = 50) AND (job_id= 'ST_MAN');

SELECT * FROM Orders
WHERE (salesman_id = 155) AND (order_date ='15.03.2018'
OR order_date ='02.11.2019');
```

## Выражения выбора

Для формирования условий выбора можно использовать специальные выражения:

- `LIKE 'шаблон'`: Совпадает ли часть строкового значения с заданным шаблоном:
  [first_name LIKE '_а%'];
- `BETWEEN V_MIN AND V_MAX`:  
  Находится ли значение столбца в диапазоне от V_MIN до V_МАХ:
  [rating_e BETWEEN 2 And 4]:
- `IN(список)`: Совпадает ли значение столбца с одним из элементов списка
  значений: [rating_e IN (2;4)];
- `IS NULL`: Значение столбца не определено: [rating_e IS NULL];

### Выражение LIKE

Выражение LIKE применяется при работе со строками. Оно проверяет, совпадет ли
часть строки с заданным шаблоном. Если совпадение найдено, то оператор
возвращает значение TRUE, в противном случае возвращается FALSE.

Для создания шаблонов в выражении LIKE используются следующие
символы:

- символ подчеркивания "_" — обозначает один символ;
- символ процента "%" — обозначает любую, в том числе и пустую,
  последовательность символов.

Синтаксис:

```
{имя столбца} LIKE 'шаблон'
```

Примеры использования выражения LIKE:

- Вывод данных о сотрудниках, имена которых начинаются на букву L:

```
 SELECT employee_id, first_name, last_name, department_id
 FROM Employees
 WHERE first_name LIKE ' L% ';
```

- Вывести имена сотрудников, вторым символом которых является буква "а":

```
SELECT DISTINCT first_name
FROM Employees
WHERE first_name LIKE '_a%’;
```

Вывести имена сотрудников, которые состоят из четырех символов, начинаются на
букву J и заканчиваются буквой п:

```
SELECT DISTINCT first_name
FROM Employees
WHERE first_name LIKE 'J__n';
```

Для поиска в строке символов_ и % при построении шаблона используется
опция ESCAPE 7'. Символ, который в шаблоне будет располагаться после /,
будет рассматриваться как символ поиска. Вместо символа / можно использовать
и другие символы, например !.

Вывести имена и адреса клиентов, столбец address которых содержит символ "_":

```
SELECT c_name, address,
FROM Customers
WHERE address LIKE '%/_%' ESCAPE '/'
```

### Выражение BETWEEN

_Выражение BETWEEN используется для того, чтобы
результат запроса содержал только те строки, в которых
значение проверяемого столбца находится в заданном
диапазоне, включая его границы._

**Синтаксис:**

{имя столбца} BETWEEN V_MIN AND V_MAX

- V MIN — нижняя граница диапазона;
- V_MAX — верхняя граница диапазона.

Выражение BETWEEN эквивалентно двум операциям сравнения, объединенным логическим
оператором AND.

    ({имя столбца} >= V_MIN) AND ({имя столбца} >= Ѵ_МАХ)

### Выражение IN

Выражение Ш используется для того, чтобы результат
запроса содержал только те строки, в которых значение
проверяемого столбца совпадает с одним из значений,
указанных в списке.

Синтаксис:

    {имя столбца} IN {список значений}

Пример:

Вывести данные о сотрудниках, которые работают в отделах с определенными
номерами:

```
SELECT employee_id, first_name, last_name, department_id
FROM Employees
WHERE department_id IN (40, 10, 110);
```

### Выражение IS NULL

Выражение IS NULL используется для определения строк с
неопределенным значением заданного столбца.

    {имя столбца} IS NULL

Это выражение возвращает значение TRUE, если значение проверяемого
столбца будет NULL.

## Вычисляемые столбцы

В предложении SELECT, кроме списка столбцов таблиц, участвующих в запросе, могут
присутствовать вычисляемые столбцы, которые представляют собой выражения,
состоящие из имен столбцов, констант, функций и арифметических операций.
Значению вычисляемого столбца можно присвоить имя. Для этого используется
следующая конструкция

    {Выражение} As {псевдоним}

